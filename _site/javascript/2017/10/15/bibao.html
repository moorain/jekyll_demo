<!DOCTYPE html>
　　<html>
	 <head>
<!--　
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
　　　<title>关于闭包的理解</title>
-->

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>关于闭包的理解</title>
    <!--ico-->
     <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="favicon/favicon.ico" type="image/x-icon" />
    <!-- Bootstrap -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <style type="text/css">
body{
	padding-top: 30px;
	background-color: #F4F4F4;
}
#nav{
	width: 100%;
	position: fixed;
	top: 0;
}
.eassy{
	border-radius: 5px;
	background-color: white;
	padding-top: 30px;
	padding-left: 20px;
	box-shadow: 0 1px 3px rgba(0,0,0,.1);
}	
.eassy ul li{
	border-bottom:1px  dashed #ccc ;
	padding-bottom: 10px;
	margin-right: 20px;
	list-style: none;
	
}
#list{
	margin-top: 20px;
	padding: 20px;
}
#date{
	float: right;
}

/*文章样式*/
#toc{
	margin-top: 20px;
    border: 1px solid #C0C0C0;
	margin-right: 30px;
	padding: 20px 0;
	position: fixed;
	top: 60px;
	left: 20px;
}
#toc h2{
	text-indent: 10px;
	padding-bottom: 10px;
	margin: 0;
}
#toc a{
	display: block;
	height: 26px;
	line-height: 26px;
	font-size: 12px;
	display: block;
	width: 100%;
	cursor: pointer;
	color: grey;
	text-align: left;
	text-indent: 10px;
	text-decoration: none;
}
#toc a:hover{
	background: gainsboro;
	color: #333333;
}
#easypage{
    border: 1px solid #C0C0C0;
	padding: 20px 0;
	margin: 30px 0px;
}
#easypage-con{
	padding: 0 20px;
}
#easypage-con h2{
	padding: 20px 0;
	margin: 0;
}
#easypage-con .zhai{
	background:#F4F4F4 ;
	font-size: small;
	text-align: left;
	text-indent: 10px;
	margin-top: 20px;
}
#easypage-con img{
	width: 100%
}
#easypage-con pre{
	overflow: scroll;
}
/*tag*/
#tagslist a{
	margin-left: 10px;
	padding: 10px;
	display: inline-block;
	height: 40px;
	border: 1px solid #C0C0C0;
	border-radius: 10px;
	color: #333;
	text-align: center;
	text-decoration: none;
}
#tagslist a:hover{
	background: #eee;
}

#list{
	border: 1px solid #eee;
	padding: 20px 20px;
	margin: 0px 0px;
	background: white;
}
    </style>
　　</head>
<body>
	<!-- 顶部导航开始 -->
	
<nav class="navbar navbar-default" id="nav">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false" style="background: gainsboro;">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/jekyll_demo/">Moorain</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="active"><a href="/jekyll_demo/">Home <span class="sr-only">(current)</span></a></li>
        <li class="blogli"><a href="/jekyll_demo/list/">Blog</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="#">Action</a></li>
            <li><a href="#">Another action</a></li>
            <li><a href="#">Something else here</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="#">Separated link</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="#">One more separated link</a></li>
          </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#">Link</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="#">Action</a></li>
            <li><a href="#">Another action</a></li>
            <li><a href="#">Something else here</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="#">Separated link</a></li>
          </ul>
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
	<!--顶部导航结束-->
<!--banner-->
<!--banner结束-->
	<div class="col-md-2 hidden-xs" id="toc" style="background: white;">
		<h2>目录</h2>
	</div>
<div class=" feature container" id="content" style="padding: 0;">
	<div class="col-md-2" id="toc2"></div>
    <div class="col-md-10 " id="easypage" style="padding: 0;">
		<div id="easypage-con" style="background: white;line-height: 26px;color: #333;">
			<h2>关于闭包的理解</h2>
<p class="zhai">摘要：闭包就是一种作用域的体现，体现函数内的变量可以访问函数外的数据，正常情况下函数外的语句不能访问函数内的变量，可以通过闭包解决这个问题。闭包其实是一种跨作用域访问数据的方式。</p>
<!--<p>15 Oct 2017</p>-->
<h3 id="什么是闭包">什么是闭包？</h3>
<p>闭包其实是一种跨作用域访问数据的方式。<br />
闭包就是一种<strong>作用域的体现</strong>，体现函数内的变量可以访问函数外的数据，正常情况下函数外的语句不能访问函数内的变量，可以通过闭包解决这个问题。</p>
<h3 id="闭包有什么用">闭包有什么用？</h3>
<p>所有<strong>跨作用域访问数据</strong>的应用：记不重复的计数器、封装…</p>
<h3 id="闭包的写法">闭包的写法？</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//第一种：直接将内部函数暴露给全局
(function(){
	var i=0;
	window.aaa=function(){
		return ++i;
	};
})();

//第二种： 将函数执行的结果返回
	var aaa=(function(){
		var i=0;//在内存中定义一个变量
		return function(){
			return ++i;
		}
	})();

	//执行完一遍后将自身代码更改为:
	var aaa=function(){
			return ++i;
	}; 此时变量i还存在内存中。内部函数可以访问i  然后再将结果返回给aaa; 其中变量i永久封闭，其他函数不能访问，只有aaa能访问，此方法可以彻底的将变量i封闭起来。  这也是一种闭包的形式。 闭包还有很多种形式。
</code></pre></div></div>

<h3 id="闭包的实现原理举例1">闭包的实现原理举例1</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//需求：制作一个永不重复的计数器
一般做法：
var i=0;
function count(){
	return ++i;
}

console.log( count() );
console.log( count() );
i=0; //可以对全局变量进行修改，无法实现永不重复
console.log( count() );
console.log( count() );
console.log( count() );
</code></pre></div></div>

<p>使用闭包实现：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//使用闭包来实现：
(function(){
	var i=0;//在内存中定义一个变量
	window.aaa=function(){
		return ++i;
	};
})();	

console.log( aaa() );
console.log( aaa() );
i=0;
console.log( aaa() );
console.log( aaa() );
console.log( aaa() );
</code></pre></div></div>

<p>实现原理如下图：</p>

<p><img src="https://i.imgur.com/hQ9iAAV.png" alt="" /></p>

<p>内层函数可以访问外层函数的数据，外层函数可以访问全局作用域内的数据。按照正常的逻辑，全局是不能访问内部的函数的，但是，将内部函数count挂载到全局上（window.aaa），此时aaa又是function的内部函数，又是全局函数。<br />
这样就产生了一种特殊的结构，这种特殊的语法结构就是<strong>闭包</strong>。</p>

<p>上例，内部函数count（也就是aaa）的数据来自它的外层函数，也就是说它可以访问到i = 0。<br />
但此时aaa又是window一个全局指向的位置，count（也就是aaa）又可以被全局所调用。<br />
所以在全局作用域下，可以访问到内部函数count，也就是实例中的aaa作用域中的数据。 <br />
<br /> 
将内部函数count赋给全局之后，全局可以访问到count，然后内部函数count可以访问到它的外层函数function作用域的数据。由此，就可以实现全局下访问函数作用域的数据，形成闭包。</p>

<h3 id="闭包的实现原理举例2">闭包的实现原理举例2</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//需求:制作一个定时器，每秒按顺序输出12345; 
for(var i=1; i&lt;=5; i++){
	(function(i){
		setTimeout(function(){
			console.log(i);
		},1000*i);
	})(i);
}
</code></pre></div></div>

<p>如果不封装setTimeout代码,内部函数访问的作用域是全局变量,此时内部函数只能得到循环过后的i值,此时i = 6。		<br />
解决办法是用IIFE立即执行函数表达式将setTimeout代码封装起来,使其有一个独立的作用域。<br />
for循环每次循环一次,将会开启一个函数作用域,传入一个i值参与运行,此时的i值就是这个局部作用域的局部变量。这样也形成了闭包。</p>
<h3 id="总结">总结</h3>

<p>闭包的特征：</p>

<ol>
  <li>函数内嵌套函</li>
  <li>正常情况下函数内可以访问函数外的数据，函数外不能访问函数内的数据</li>
  <li>可以将内部函数暴露到全局上，或者返回给全局变量，实现外部可以访问函数内部的数据</li>
  <li>由于函数内的数据被全局所占用，延缓资源的回收</li>
</ol>


		</div>	
     </div>
</div>
		
　　　　


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
     <script type="text/javascript">
     	window.onload = function(){
     		var ti = $("h3")
     		for(i = 0;i<ti.length;i++){
     			var  aa  = document.createElement('a');  
	     		console.log(aa)
	     		$("#toc").append(aa);
	     		
     		}
     		var num = [];
	     	for(var i = 0;i<ti.length;i++){
//	     		var aa = $('<a></a>').text("111")
				
			//得到每个h3标签内的文字，加入到目录a标签内
	     		var txt = $("h3")[i].innerHTML;
	     	    $("#toc a")[i].innerHTML = txt;
			//将获取到h3标签的高度存入数组中
	     	    var top = $("h3")[i].offsetTop;
	     	    num.push(top);
	     	}
			//设置点击事件
	     	     $("#toc a").click(function(){
	     	     	var index = $("#toc a").index(this)
	     	    	$("body").scrollTop(num[index])
	     	    })
     	}
     	
     	


     </script>
　　</body>
</html>